### 이벤트 루프

---

#### 콜 스택과 큐의 흐름 제어를 담당하는 이벤트 루프

자바스크립트는 싱글 스레드로, 한 번에 한 가지 일만 수행할 수 있다. 이것이 주는 문제는 여러가지 일 중 하나의 일이 30초 이상 걸린다고 생각해보자. 그렇다면 그 일을 처리하는 30초 동안 우리는 아무것도 할 수가 없다. (브라우저의 메인 스레드로 동작하기에 UI가 멈추게 됨)

그 해결책으로 브라우저는 브라우저 자체에서 제공하는 웹 API 기능을 제공한다. 이 API는 우리가 비동기, 즉 non-block 동작을 가능케 한다.

함수를 실행하면 그 함수는 자바스크립트 엔진의 한 부분인 콜 스택에 쌓이게 되고, 함수가 값을 반환하면 그 함수는 스택에서 빠져나와 사라진다. 순서는 선입후출로 동작한다. (한 카페의 쌓여있는 트레이를 떠올려보자. 제일 나중에 쌓은 트레이가 먼저 나간다.)

웹 API 중 하나인 `setTimeout()`를 사용해보자.

```js
'use strict';

const foo = () => console.log('First');
const bar = () => setTimeout(() => console.log('Second'), 500);
const baz = () => console.log('Third');

bar();
foo();
baz();

// First
// Third
// Second
```

1. `bar()`를 호출해서 `setTimeout()`을 반환한다.
2. `bar()`는 웹 API에 추가되고, 콜 스택에서 빠져나온다.
3. 웹 API에서 `setTimeout()`이 실행되는 동안 `foo()`와 `baz()`가 호출되고 콜 스택에 쌓인다.
4. `setTimeout()`이 실행이 완료되면 해당 콜백이 큐에 추가 된다.
5. `foo()`와 `baz()` 반환이 완료되고 콜 스택에서 사라진다.
6. 콜 스택이 빈 것을 확인한 이벤트 루프가 큐에 추가된 콜백을 콜 스택에 추가한다.
7. 콜백이 실행된다.

큐는 선입선출로 동작한다. (우리가 놀이공원에서 줄을 섰다고 생각하자. 제일 먼저 줄을 선 사람이 제일 먼저 놀이기구를 탄다.)

- 이런 흐름 제어? 순서를 알고 자바스크립트의 특징을 알아야 버그를 잡을 때 좀 더 수월하지 않을까? 여전히 어려운 이벤트 루프를 조금은 이해하게 되었다. 스택오버 플로우를 경험해보지도, 실무도 안해봤지만 미리 알아두면 반드시 쓸모가 있을 것 같다.
